<!-- pages/note/detail/detail.wxml -->
<view class="container" wx:if="{{note}}">
  <!-- ç¬”è®°å¤´éƒ¨ -->
  <view class="note-header">
    <view class="header-top">
      <view class="note-tag">{{note.tag}}</view>
      <view class="note-lock" wx:if="{{note.isLocked}}">ğŸ”’</view>
    </view>

    <text class="note-title">{{note.title}}</text>

    <view class="note-meta">
      <text class="meta-item">åˆ›å»ºäº {{note.createTimeStr}}</text>
      <text class="meta-item" wx:if="{{note.updateTime}}">æ›´æ–°äº {{note.updateTimeStr}}</text>
    </view>
  </view>

  <!-- ç¬”è®°å†…å®¹ -->
  <view class="note-content-section">
    <view wx:if="{{!isEditing}}">
      <text class="note-content">{{note.content}}</text>
    </view>

    <view wx:if="{{isEditing}}">
      <textarea
        class="note-textarea"
        value="{{editContent}}"
        placeholder="è¯·è¾“å…¥ç¬”è®°å†…å®¹"
        maxlength="-1"
        auto-height
        bindinput="onContentInput"
      />
    </view>
  </view>

  <!-- å›¾ç‰‡ -->
  <view class="note-images" wx:if="{{note.images && note.images.length > 0}}">
    <view class="images-title">ç›¸å…³å›¾ç‰‡</view>
    <view class="images-grid">
      <image
        class="image-item"
        wx:for="{{note.images}}"
        wx:key="index"
        src="{{item}}"
        mode="aspectFill"
        bindtap="previewImage"
        data-index="{{index}}"
      />
    </view>
  </view>

  <!-- å…³é”®è¯ -->
  <view class="note-keywords" wx:if="{{note.keywords && note.keywords.length > 0}}">
    <view class="keywords-title">å…³é”®è¯</view>
    <view class="keywords-list">
      <view class="keyword-item" wx:for="{{note.keywords}}" wx:key="index">
        {{item}}
      </view>
    </view>
  </view>

  <!-- å¾…åŠäº‹é¡¹ -->
  <view class="note-todos" wx:if="{{note.todos && note.todos.length > 0}}">
    <view class="todos-title">å¾…åŠäº‹é¡¹</view>
    <view class="todos-list">
      <view class="todo-item" wx:for="{{note.todos}}" wx:key="index">
        <text class="todo-number">{{index + 1}}.</text>
        <text class="todo-text">{{item}}</text>
      </view>
    </view>
  </view>

  <!-- å…³è”ç¬”è®°æ¨è -->
  <view class="related-notes" wx:if="{{relatedNotes && relatedNotes.length > 0}}">
    <view class="related-header">
      <text class="related-title">ğŸ”— ç›¸å…³ç¬”è®°</text>
      <text class="related-desc">åŸºäºå†…å®¹æ™ºèƒ½æ¨è</text>
    </view>
    <view class="related-list">
      <view class="related-item"
            wx:for="{{relatedNotes}}"
            wx:key="id"
            bindtap="goToRelatedNote"
            data-id="{{item.id}}">
        <view class="related-item-header">
          <text class="related-item-title">{{item.title}}</text>
          <view class="related-item-tag">{{item.tag}}</view>
        </view>
        <text class="related-item-content">{{item.shortContent}}</text>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <view wx:if="{{!isEditing}}" class="button-group">
      <button class="btn-secondary" bindtap="startEdit">ç¼–è¾‘</button>
      <button class="btn-secondary" bindtap="copyContent">å¤åˆ¶</button>
      <button class="btn-secondary" bindtap="exportNote">å¯¼å‡º</button>
      <button class="btn-secondary" bindtap="shareToWeChat">åˆ†äº«</button>
      <button class="btn-secondary" bindtap="lockNote" wx:if="{{!note.isLocked}}">é”å®š</button>
      <button class="btn-ghost" bindtap="deleteNote">åˆ é™¤</button>
    </view>

    <view wx:if="{{isEditing}}" class="button-group">
      <button class="btn-primary" bindtap="saveEdit">ä¿å­˜</button>
      <button class="btn-ghost" bindtap="cancelEdit">å–æ¶ˆ</button>
    </view>
  </view>
</view>

<view class="empty-state" wx:if="{{!note}}">
  <text class="empty-icon">ğŸ“</text>
  <text class="empty-text">ç¬”è®°ä¸å­˜åœ¨</text>
</view>
