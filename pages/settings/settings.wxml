<!-- pages/settings/settings.wxml -->
<view class="container">
  <!-- 用户信息 -->
  <view class="user-section" wx:if="{{!userInfo.nickName}}" bindtap="showLoginModal">
    <view class="user-avatar">👤</view>
    <view class="user-info">
      <text class="user-name">未登录</text>
      <text class="user-stats">点击登录</text>
    </view>
  </view>
  <view class="user-section" wx:else>
    <image class="user-avatar" src="{{userInfo.avatarUrl}}" />
    <view class="user-info">
      <text class="user-name">{{userInfo.nickName}}</text>
      <text class="user-stats">共 {{noteCount}} 条笔记</text>
    </view>
  </view>

  <!-- 登录弹窗 -->
  <view class="modal" wx:if="{{showLoginModal}}" bindtap="closeLoginModal">
    <view class="modal-content login-modal" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">登录</text>
        <text class="modal-close" bindtap="closeLoginModal">×</text>
      </view>
      <view class="modal-body login-body">
        <text class="login-tip">请填写你的昵称和头像</text>
        <view class="avatar-wrapper">
          <button class="avatar-btn" open-type="chooseAvatar" bindchooseavatar="onChooseAvatar">
            <image class="avatar-preview" src="{{tempAvatarUrl || '/images/default-avatar.png'}}" wx:if="{{tempAvatarUrl}}" />
            <view class="avatar-placeholder" wx:else>
              <text class="avatar-icon">📷</text>
              <text class="avatar-text">选择头像</text>
            </view>
          </button>
        </view>
        <input
          class="nickname-input"
          type="nickname"
          placeholder="请输入昵称"
          value="{{tempNickName}}"
          bindinput="onNicknameInput"
          adjust-position="{{true}}"
        />
        <button class="confirm-login-btn" bindtap="confirmLogin">确认登录</button>
      </view>
    </view>
  </view>

  <!-- 设置列表 -->
  <view class="settings-section">
    <text class="section-title">标签管理</text>
    <view class="setting-item" bindtap="manageTags">
      <view class="item-left">
        <text class="item-icon">🏷️</text>
        <text class="item-label">自定义标签</text>
      </view>
      <view class="item-right">
        <text class="item-value">{{tags.length}} 个</text>
        <text class="item-arrow">›</text>
      </view>
    </view>
  </view>

  <view class="settings-section">
    <text class="section-title">数据管理</text>
    <view class="setting-item" bindtap="exportAllNotes">
      <view class="item-left">
        <text class="item-icon">📤</text>
        <text class="item-label">导出所有笔记</text>
      </view>
      <text class="item-arrow">›</text>
    </view>
    <view class="setting-item" bindtap="clearCache">
      <view class="item-left">
        <text class="item-icon">🗑️</text>
        <text class="item-label">清除缓存</text>
      </view>
      <view class="item-right">
        <text class="item-value">{{cacheSize}}</text>
        <text class="item-arrow">›</text>
      </view>
    </view>
    <view class="setting-item danger" bindtap="clearAllData">
      <view class="item-left">
        <text class="item-icon">⚠️</text>
        <text class="item-label">清空所有数据</text>
      </view>
      <text class="item-arrow">›</text>
    </view>
  </view>

  <view class="settings-section">
    <text class="section-title">关于</text>
    <view class="setting-item" bindtap="showAbout">
      <view class="item-left">
        <text class="item-icon">ℹ️</text>
        <text class="item-label">关于应用</text>
      </view>
      <view class="item-right">
        <text class="item-value">v1.0.0</text>
        <text class="item-arrow">›</text>
      </view>
    </view>
    <view class="setting-item" bindtap="showHelp">
      <view class="item-left">
        <text class="item-icon">❓</text>
        <text class="item-label">使用帮助</text>
      </view>
      <text class="item-arrow">›</text>
    </view>
  </view>

  <view class="settings-section" wx:if="{{userInfo.nickName}}">
    <text class="section-title">账号管理</text>
    <view class="setting-item" bindtap="switchAccount">
      <view class="item-left">
        <text class="item-icon">🔄</text>
        <text class="item-label">切换账号</text>
      </view>
      <text class="item-arrow">›</text>
    </view>
    <view class="setting-item danger" bindtap="logout">
      <view class="item-left">
        <text class="item-icon">🚪</text>
        <text class="item-label">退出登录</text>
      </view>
      <text class="item-arrow">›</text>
    </view>
  </view>

  <!-- 标签管理弹窗 -->
  <view class="modal" wx:if="{{showTagModal}}" bindtap="closeTagModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">标签管理</text>
        <text class="modal-close" bindtap="closeTagModal">×</text>
      </view>
      <view class="modal-body">
        <view class="tag-input-wrapper">
          <input
            class="tag-input"
            type="text"
            value="{{newTag}}"
            placeholder="输入新标签名称"
            bindinput="onTagInput"
          />
          <button class="add-tag-btn" bindtap="addTag">添加</button>
        </view>
        <view class="tag-list">
          <view
            class="tag-item-row"
            wx:for="{{tags}}"
            wx:key="index"
          >
            <text class="tag-name">{{item}}</text>
            <text class="delete-tag" bindtap="deleteTag" data-tag="{{item}}">删除</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>
